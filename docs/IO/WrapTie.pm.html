<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!-- Generated by pod2coolhtml 1.101
  -- Using Pod::CoolHTML 1.104 , (C) 1997 by Eryq (eryq@zeegee.com).
  --
  -- DO NOT EDIT THIS HTML FILE! All your changes will be lost.
  -- Edit the POD or Perl file that was used to create it.
  -->
<HTML>

<HEAD>
<TITLE>IO::WrapTie</TITLE>
</HEAD>
<BODY LINK=#C00000 ALINK=#FF2020 VLINK=#900000>
<A NAME="__top"> </A><CENTER><TABLE BORDER=2 CELLPADDING=2 WIDTH=100%>

<TR>
<TD WIDTH=25% ALIGN=CENTER><B><SMALL>
<A HREF="Lines.pm.html">IO::Lines</A></SMALL></B></TD>

<TD WIDTH=25% ALIGN=CENTER><B><SMALL>
<A HREF="Scalar.pm.html">IO::Scalar</A></SMALL></B></TD>

<TD WIDTH=25% ALIGN=CENTER><B><SMALL>
<A HREF="ScalarArray.pm.html">IO::ScalarArray</A></SMALL></B></TD>

<TD WIDTH=25% ALIGN=CENTER><B><SMALL>
<A HREF="Wrap.pm.html">IO::Wrap</A></SMALL></B></TD>

<TR>
<TD WIDTH=25% ALIGN=CENTER><B><SMALL>
IO::WrapTie</SMALL></B></TD>
</TABLE></CENTER>

<P><TABLE WIDTH="100%">

<TR VALIGN="TOP"><TD ALIGN="LEFT"><CENTER>
<H1><FONT SIZE=7 COLOR=#600020><B>IO::<BR>WrapTie</B></FONT></H1></CENTER>
<TD>
<UL>
<LI><A HREF="#name">NAME</A>
</LI><LI><A HREF="#synopsis">SYNOPSIS</A>
</LI><LI><A HREF="#description">DESCRIPTION</A>
</LI><LI><A HREF="#notes">NOTES</A>
</LI><LI><A HREF="#warnings">WARNINGS</A>
</LI><LI><A HREF="#author">AUTHOR</A>
</LI></UL>

</TABLE>

<P><HR>
<A NAME="name">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
NAME</FONT></H1>
</A>


<P>
IO::WrapTie - wrap tieable objects in IO::Handle interface


<P><HR>
<A NAME="synopsis">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
SYNOPSIS</FONT></H1>
</A>


<P>
First of all, you'll need tie(), so:


<P>
<PRE>   require 5.004;</PRE>



<P>
Use this with any existing class...


<P>
<PRE>   use IO::WrapTie;
   use FooHandle;         # this is *not* an IO::Handle subclass (see below)</PRE>



<P>
<PRE>   # Assuming we want a &quot;FooHandle-&gt;new(&amp;FOO_RDWR, 2)&quot;, we can instead say...
   $FH = IO::WrapTie-&gt;new('FooHandle', &amp;FOO_RDWR, 2);</PRE>



<P>
<PRE>   # Look, ma!  It works just like a real IO::Handle!  
   print $FH &quot;Hello, &quot;;            # traditional indirect-object syntax
   $FH-&gt;print(&quot;world!\n&quot;);         # OO syntax
   print $FH &quot;Good&quot;, &quot;bye!\n&quot;;     # traditional 
   $FH-&gt;seek(0, 0);                # OO
   @lines = &lt;$FH&gt;;                 # traditional (get the picture...?)</PRE>



<P>
Or inherit from it to get a nifty new_tie() constructor...


<P>
<PRE>   package FooHandle;     # this is *not* an IO::Handle subclass (see below)
   use IO::WrapTie;
   @ISA = qw(IO::WrapTie::Mixin);
   ...</PRE>



<P>
<PRE>   package main;    
   $FH = FooHandle-&gt;new_tie(&amp;FOO_RDWR, 2);
   print $FH &quot;Hello, &quot;;            # traditional indirect-object syntax
   $FH-&gt;print(&quot;world!\n&quot;);         # OO syntax</PRE>



<P><HR>
<A NAME="description">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
DESCRIPTION</FONT></H1>
</A>


<P>
Suppose you have a class <CODE>FooHandle</CODE>, where...

<UL>

<P><LI>FooHandle does <I>not</I> inherit from IO::Handle; that is, it performs
filehandle-like I/O, but to something other than an underlying
file descriptor.  Good examples are IO::Scalar (for printing to a
string) and IO::Lines (for printing to an array of lines).


<P><LI>FooHandle implements the TIEHANDLE interface (see <A HREF="../perltie.html">perltie</A>);
that is, it provides methods TIEHANDLE, GETC, PRINT, PRINTF,
READ, and READLINE.


<P><LI>FooHandle can be used in an ordinary OO-ish way via conventional
FileHandle- and IO::Handle-compatible methods like getline(), 
read(), print(), seek(), tell(), eof(), etc.

</UL>


<P>
Normally, users of your class would have two options:

<UL>

<P><LI>Use only OO syntax, and forsake named I/O operators like 'print'.


<P><LI>Use with tie, and forsake treating it as a first-class object (i.e.,
class-specific methods can only be invoked through the underlying
object via tied()... giving the object a &quot;split personality&quot;).

</UL>


<P>
But now with IO::WrapTie, you can say:


<P>
<PRE>    $W = IO::WrapTie-&gt;new('FooHandle', &amp;FOO_RDWR, 2);
    $W-&gt;print(&quot;Hello, world\n&quot;);   # OO syntax
    print $W &quot;Yes!\n&quot;;             # Named operator syntax too!
    $W-&gt;weird_stuff;               # Other methods!</PRE>



<P>
And if you're providing such a class, just inherit from 
<CODE>IO::WrapTie::Mixin</CODE> and that first line becomes even prettier:


<P>
<PRE>    $FH = FooHandle-&gt;new_tie(&amp;FOO_RDWR, 2);</PRE>



<P>
<B>The bottom line:</B> now, almost any class can look and work exactly like
an IO::Handle... and be used both with OO and non-OO filehandle syntax.


<P><HR>
<A NAME="notes">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
NOTES</FONT></H1>
</A>


<P>
<B>Why not simply use the object's OO interface?</B> 
    Because that means forsaking the use of named operators
like print(), and you may need to pass the object to a subroutine
which will attempt to use those operators:


<P>
<PRE>    $O = FooHandle-&gt;new(&amp;FOO_RDWR, 2);
    $O-&gt;print(&quot;Hello, world\n&quot;);  # OO syntax is okay, BUT....</PRE>



<P>
<PRE>    sub nope { print $_[0] &quot;Nope!\n&quot; }
 X  nope($O);                     # ERROR!!! (not a glob ref)</PRE>



<P>
<B>Why not simply use tie()?</B> 
    Because (1) you have to use tied() to invoke methods in the
object's public interface (yuck), and (2) you may need to pass 
the tied symbol to another subroutine which will attempt to treat 
it in an OO-way... and that will break it:


<P>
<PRE>    tie *T, 'FooHandle', &amp;FOO_RDWR, 2; 
    print T &quot;Hello, world\n&quot;;     # Operator is okay, BUT... </PRE>



<P>
<PRE>    tied(*T)-&gt;other_stuff;        # yuck! AND...</PRE>



<P>
<PRE>    sub nope { shift-&gt;print(&quot;Nope!\n&quot;) }
 X  nope(\*T);                    # ERROR!!! (method &quot;print&quot; on unblessed ref)</PRE>



<P>
<B>Why not simply write FooHandle to inherit from IO::Handle?</B>
    I tried this, with an implementation similar to that of IO::Socket.  
The problem is that <I>the whole point is to use this with objects
that don't have an underlying file/socket descriptor.</I>.
Subclassing IO::Handle will work fine for the OO stuff, and fine with 
named operators <I>if</I> you tie()... but if you just attempt to say:


<P>
<PRE>    $IO = FooHandle-&gt;new(&amp;FOO_RDWR, 2);
    print $IO &quot;Hello!\n&quot;;</PRE>



<P>
you get a warning from Perl like:


<P>
<PRE>    Filehandle GEN001 never opened</PRE>



<P>
because it's trying to do system-level i/o on an (unopened) file 
descriptor.  To avoid this, you apparently have to tie() the handle...
which brings us right back to where we started!  At least the
IO::WrapTie mixin lets us say:


<P>
<PRE>    $IO = FooHandle-&gt;new_tie(&amp;FOO_RDWR, 2);
    print $IO &quot;Hello!\n&quot;;</PRE>



<P>
and so is not <I>too</I> bad.  <CODE>:-)</CODE>


<P><HR>
<A NAME="warnings">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
WARNINGS</FONT></H1>
</A>


<P>
<B>Be aware that <CODE>new_tie()</CODE> always returns an instance of IO::WrapTie...</B>
it does <B>not</B> return an instance of the i/o class you're tying to!  
All OO-like use of this IO::WrapTie object is handled by the AUTOLOAD
method, which for each message <I>msg</I> simply creates a &quot;delegator&quot;
method IO::WrapTie::<I>msg</I> that passes <I>msg</I> on to the back-end
object... so it <I>looks</I> like you're manipulating a &quot;FooHandle&quot; object
directly, but you're not.


<P>
I have not explored all the ramifications of this use of tie().
<I>Here there be dragons</I>.


<P><HR>
<A NAME="author">
<H1><FONT COLOR=#600020>
<A HREF="#__top"><IMG SRC="IO-stringy/h1bullet.gif" ALT="" BORDER="0"></A>
AUTHOR</FONT></H1>
</A>


<P>
Eryq (<I><A HREF="mailto:eryq@zeegee.com">eryq@zeegee.com</A></I>).
President, Zero G Inc (<I><A HREF="http://www.zeegee.com">http://www.zeegee.com</A></I>).


<P><HR>
<SMALL>
		Last updated: Fri Mar 27 02:33:13 1998 <BR>
		Generated by pod2coolhtml 1.101.  Want a copy?  Just email
		<A HREF="mailto:eryq@zeegee.com">eryq@zeegee.com</A>.
		(Yes, it's free.)
		</SMALL></BODY>
</HTML>
